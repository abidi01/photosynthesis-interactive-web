<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´¾æ ¼é“å¤«å®éªŒæ¨¡æ‹Ÿå·¥å…·</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 0;
            background-color: #f5f9fa;
        }
        
        .main-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        nav {
            background: linear-gradient(to right, #2D7D46, #1B5E20);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0.75rem 1.25rem;
        }
        
        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .nav-brand {
            display: flex;
            align-items: center;
        }
        
        .nav-brand span {
            font-size: 1.5rem;
            margin-right: 0.75rem;
        }
        
        .nav-brand h1 {
            font-size: 1.25rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin: 0;
        }
        
        .nav-links {
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
        }
        
        .nav-item {
            color: white;
            text-decoration: none;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
            display: inline-block;
        }
        
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .nav-item.active {
            background: rgba(255, 255, 255, 0.4);
        }
        header {
            background-color: #2c7873;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        h1 {
            margin: 0;
        }
        .simulator-section {
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h2 {
            color: #2c7873;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        .controls {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .control-group {
            margin: 10px;
            text-align: center;
            min-width: 180px;
        }
        button {
            background-color: #2c7873;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            width: 100%;
        }
        button:hover {
            background-color: #235d59;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .action-buttons button {
            width: auto;
            padding: 10px 20px;
        }
        .reset-btn {
            background-color: #e74c3c;
        }
        .stop-btn {
            background-color: #f39c12;
        }
        .light-control {
            margin: 20px auto;
            text-align: center;
        }
        .light-switch {
            background-color: #f39c12;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: inline-block;
        }
        .light-off {
            background-color: #7f8c8d;
        }
        .simulator-container {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }
        .beaker {
            display: inline-block;
            width: 200px;
            height: 250px;
            margin: 0 30px;
            position: relative;
            border-radius: 0 0 20px 20px;
            border: 3px solid #333;
            overflow: hidden;
            vertical-align: bottom;
        }
        .liquid {
            position: absolute;
            bottom: 0;
            width: 100%;
            transition: height 1s, background-color 1s;
        }
        .beaker-label {
            position: absolute;
            bottom: -25px;
            width: 100%;
            text-align: center;
            font-weight: bold;
        }
        .thylakoid {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: #4CAF50;
            border-radius: 50%;
            transition: all 1s;
        }
        .atp-counter {
            font-size: 24px;
            font-weight: bold;
            color: #d35400;
            margin: 20px 0;
        }
        .status-message {
            padding: 10px;
            background-color: #e8f4f8;
            border-radius: 5px;
            margin: 10px 0;
            min-height: 20px;
        }
        .ph-indicator {
            display: block;
            padding: 2px 8px;
            border-radius: 3px;
            font-weight: bold;
            margin: 5px auto;
            width: fit-content;
        }
        .ph4 {
            background-color: #ffcccc;
            color: #cc0000;
        }
        .ph8 {
            background-color: #ccffff;
            color: #0066cc;
        }
        .light-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 0, 0.1);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .atp-particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: yellow;
            border-radius: 50%;
            opacity: 0;
            animation: float 2s ease-out;
            filter: drop-shadow(0 0 5px yellow);
        }
        @keyframes float {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px);
                opacity: 0;
            }
        }
        /* æ–°å¢ç±»å›Šä½“è†œæ ·å¼ */
        .membrane-section {
            margin: 30px 0;
            text-align: center;
        }
        .membrane-container {
            position: relative;
            width: 400px;
            height: 200px;
            margin: 0 auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            background-color: #f9f9f9;
        }
        .membrane {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 10px;
            background-color: #4CAF50;
            transform: translateY(-50%);
        }
        .atp-synthase {
            position: absolute;
            width: 40px;
            height: 60px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-color: #8BC34A;
            border-radius: 5px;
        }
        .atp-synthase::after {
            content: "ATPåˆé…¶";
            position: absolute;
            bottom: -20px;
            width: 100%;
            text-align: center;
            font-size: 12px;
            color: #333;
        }
        .stroma {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background-color: rgba(204, 255, 255, 0.3);
        }
        .lumen {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background-color: rgba(255, 204, 204, 0.3);
        }
        .proton {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #ff0000;
            border-radius: 50%;
            font-size: 10px;
            text-align: center;
            line-height: 10px;
            color: white;
        }
        .proton::after {
            content: "Hâº";
        }
        .membrane-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        .membrane-controls button {
            padding: 8px 15px;
            width: auto;
        }
        .add-stroma {
            background-color: #3498db;
        }
        .add-lumen {
            background-color: #e74c3c;
        }
        .proton-counter {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }
        .proton-count {
            font-weight: bold;
        }
        .stroma-count {
            color: #3498db;
        }
        .lumen-count {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav>
        <div class="nav-container">
            <div class="nav-content">
                <div class="nav-brand">
                    <span>ğŸƒ</span>
                    <h1>å…‰åˆä½œç”¨åŸç†æ¢ç´¢äº¤äº’ç½‘é¡µ</h1>
                </div>
                <div class="nav-links">
                    <a href="main.html" class="nav-item">é¦–é¡µ</a>
                    <a href="å¸Œå°”å®éªŒæ¨¡æ‹Ÿå·¥å…·.html" class="nav-item">å¸Œå°”å®éªŒ</a>
                    <a href="é˜¿å°”å†œå®éªŒæ¨¡æ‹Ÿå·¥å…·.html" class="nav-item">é˜¿å°”å†œå®éªŒ</a>
                    <a href="è´¾æ ¼é“å¤«å®éªŒæ¨¡æ‹Ÿå·¥å…·.html" class="nav-item active">è´¾æ ¼é“å¤«å®éªŒ</a>
                    <a href="å…‰ååº”.html" class="nav-item">å…‰ååº”æ¨¡å‹</a>
                    <a href="é˜¿å°”å†œè™šæ‹Ÿå®éªŒå·¥å…·2.html" class="nav-item">é˜¿å°”å†œ2</a>
                    <a href="å¡å°”æ–‡å¾ªç¯å®éªŒæ¨¡æ‹Ÿå·¥å…·.html" class="nav-item">å¡å°”æ–‡å¾ªç¯</a>
                    <a href="å…‰ååº”å’Œæš—ååº”ä¹‹é—´çš„è”ç³».html" class="nav-item">å…‰æš—ååº”è”ç³»</a>
                    <a href="å¯¹æ¥é«˜è€ƒ.html" class="nav-item">å¯¹æ¥é«˜è€ƒ</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <header style="background-color: #2c7873; color: white; padding: 20px; border-radius: 5px; margin-bottom: 20px; text-align: center;">
        <h1>è´¾æ ¼é“å¤«å®éªŒæ¨¡æ‹Ÿå·¥å…·</h1>
        <p>åŒ–å­¦æ¸—é€å‡è¯´çš„äº¤äº’å¼æ¼”ç¤º</p>
    </header>

    <section class="simulator-section">
        <h2>å®éªŒæ¨¡æ‹Ÿ</h2>
        
        <div class="light-control">
            <div class="light-switch" id="lightSwitch">å…‰ç…§: å…³é—­</div>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <button id="step1">1. å‡†å¤‡ç±»å›Šä½“</button>
                <div class="control-description">ä»è èœå¶ä¸­åˆ†ç¦»ç±»å›Šä½“</div>
            </div>
            <div class="control-group">
                <button id="step2" disabled>2. é…¸æ€§å¤„ç†</button>
                <div class="control-description">å°†ç±»å›Šä½“ç½®äº</div>
                <div class="ph-indicator ph4">pH = 4 (é…¸æ€§)</div>
            </div>
            <div class="control-group">
                <button id="step3" disabled>3. è½¬ç§»è‡³ç¼“å†²æ¶²</button>
                <div class="control-description">è½¬ç§»åˆ°å«ADP+Piçš„</div>
                <div class="ph-indicator ph8">pH = 8 (ç¢±æ€§)</div>
            </div>
            <div class="control-group">
                <button id="step4" disabled>4. è§‚å¯ŸATPåˆæˆ</button>
                <div class="control-description">æ£€æµ‹ATPçš„äº§ç”Ÿ</div>
            </div>
        </div>
        
        <div class="simulator-container">
            <div class="light-effect" id="lightEffect"></div>
            <div class="beaker" id="acidBeaker">
                <div class="liquid" id="acidLiquid" style="height: 0%; background-color: #ffcccc;"></div>
                <div class="beaker-label">é…¸æ€§æº¶æ¶²</div>
            </div>
            
            <div class="beaker" id="bufferBeaker">
                <div class="liquid" id="bufferLiquid" style="height: 0%; background-color: #ccffff;"></div>
                <div class="beaker-label">ç¼“å†²æ¶²</div>
            </div>
        </div>
        
        <div class="action-buttons">
            <button id="resetBtn" class="reset-btn">é‡ç½®å®éªŒ</button>
            <button id="stopBtn" class="stop-btn" disabled>åœæ­¢å®éªŒ</button>
        </div>
        
        <div class="atp-counter" id="atpCounter">ATPæ•°é‡: 0</div>
        <div class="status-message" id="statusMessage">è¯·ç‚¹å‡»"å‡†å¤‡ç±»å›Šä½“"å¼€å§‹å®éªŒ</div>
    </section>

    <!-- æ–°å¢ç±»å›Šä½“è†œéƒ¨åˆ† -->
    <section class="simulator-section">
        <h2>ç±»å›Šä½“è†œç»“æ„</h2>
        <div class="membrane-section">
            <div class="membrane-container">
                <div class="stroma" id="stroma"></div>
                <div class="lumen" id="lumen"></div>
                <div class="membrane"></div>
                <div class="atp-synthase"></div>
            </div>
            
            <div class="membrane-controls">
                <button id="addStromaBtn" class="add-stroma">å‘åŸºè´¨æ·»åŠ Hâº</button>
                <button id="addLumenBtn" class="add-lumen">å‘è…”ä½“æ·»åŠ Hâº</button>
            </div>
            
            <div class="proton-counter">
                <div>åŸºè´¨Hâºæµ“åº¦: <span id="stromaCount" class="proton-count stroma-count">0</span></div>
                <div>è…”ä½“Hâºæµ“åº¦: <span id="lumenCount" class="proton-count lumen-count">0</span></div>
            </div>
        </div>
    </section>

    <section class="simulator-section">
        <h2>å®éªŒåŸç†</h2>
        <div>
            <p>è´¾æ ¼é“å¤«å®éªŒçš„å…³é”®åœ¨äºäººä¸ºåˆ›å»ºè·¨è†œè´¨å­æ¢¯åº¦ï¼š</p>
            <ul>
                <li>åœ¨pH4é…¸æ€§æº¶æ¶²ä¸­ï¼Œç±»å›Šä½“è…”å†…ç§¯ç´¯Hâº</li>
                <li>è½¬ç§»åˆ°pH8ç¼“å†²æ¶²æ—¶å½¢æˆHâºæµ“åº¦å·®</li>
                <li>Hâºé€šè¿‡ATPåˆæˆé…¶æµå‡ºï¼Œé©±åŠ¨ADP+PiåˆæˆATP</li>
                <li>æ•´ä¸ªè¿‡ç¨‹ä¸éœ€è¦å…‰ç…§ï¼Œè¯æ˜Hâºæ¢¯åº¦æ˜¯ATPåˆæˆçš„é©±åŠ¨åŠ›</li>
                <li>å¼€å¯å…‰ç…§æ—¶ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°å…‰åˆç£·é…¸åŒ–è¿‡ç¨‹</li>
            </ul>
        </div>
    </section>

    <footer>
        <p>é«˜ä¸­ç”Ÿç‰©æ•™å­¦èµ„æº | è´¾æ ¼é“å¤«å®éªŒæ¨¡æ‹Ÿå·¥å…·</p>
    </footer>

    <script>
        // æ¨¡æ‹Ÿå®éªŒçŠ¶æ€
        const state = {
            thylakoidsPrepared: false,
            inAcidSolution: false,
            transferred: false,
            atpProduced: 0,
            thylakoids: [],
            lightOn: false,
            atpInterval: null,
            isRunning: false,
            stromaProtons: 0,
            lumenProtons: 0
        };

        // DOMå…ƒç´ 
        const step1Btn = document.getElementById('step1');
        const step2Btn = document.getElementById('step2');
        const step3Btn = document.getElementById('step3');
        const step4Btn = document.getElementById('step4');
        const acidBeaker = document.getElementById('acidBeaker');
        const bufferBeaker = document.getElementById('bufferBeaker');
        const acidLiquid = document.getElementById('acidLiquid');
        const bufferLiquid = document.getElementById('bufferLiquid');
        const atpCounter = document.getElementById('atpCounter');
        const statusMessage = document.getElementById('statusMessage');
        const lightSwitch = document.getElementById('lightSwitch');
        const lightEffect = document.getElementById('lightEffect');
        const resetBtn = document.getElementById('resetBtn');
        const stopBtn = document.getElementById('stopBtn');
        const addStromaBtn = document.getElementById('addStromaBtn');
        const addLumenBtn = document.getElementById('addLumenBtn');
        const stromaCount = document.getElementById('stromaCount');
        const lumenCount = document.getElementById('lumenCount');
        const stroma = document.getElementById('stroma');
        const lumen = document.getElementById('lumen');

        // åˆ›å»ºATPç²’å­æ•ˆæœ
        function createATPParticle() {
            const particle = document.createElement('div');
            particle.className = 'atp-particle';
            
            // éšæœºä½ç½®
            const x = Math.random() * 180 + 10;
            particle.style.left = `${x}px`;
            particle.style.bottom = '50px';
            
            bufferBeaker.appendChild(particle);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤ç²’å­
            setTimeout(() => {
                particle.remove();
            }, 2000);
        }

        // é‡ç½®å®éªŒ
        function resetExperiment() {
            // æ¸…é™¤æ‰€æœ‰ç±»å›Šä½“
            state.thylakoids.forEach(thylakoid => {
                thylakoid.remove();
            });
            
            // é‡ç½®çŠ¶æ€
            state.thylakoidsPrepared = false;
            state.inAcidSolution = false;
            state.transferred = false;
            state.atpProduced = 0;
            state.thylakoids = [];
            state.lightOn = false;
            state.isRunning = false;
            state.stromaProtons = 0;
            state.lumenProtons = 0;
            
            // æ¸…é™¤æ¶²ä½“
            acidLiquid.style.height = '0%';
            bufferLiquid.style.height = '0%';
            
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            step1Btn.disabled = false;
            step2Btn.disabled = true;
            step3Btn.disabled = true;
            step4Btn.disabled = true;
            stopBtn.disabled = true;
            
            // é‡ç½®å…‰ç…§
            lightSwitch.textContent = "å…‰ç…§: å…³é—­";
            lightSwitch.classList.add('light-off');
            lightEffect.style.opacity = '0';
            
            // é‡ç½®è®¡æ•°å™¨
            atpCounter.textContent = "ATPæ•°é‡: 0";
            stromaCount.textContent = "0";
            lumenCount.textContent = "0";
            
            // æ¸…é™¤ATPç”Ÿæˆé—´éš”
            if (state.atpInterval) {
                clearInterval(state.atpInterval);
                state.atpInterval = null;
            }
            
            // æ¸…é™¤æ‰€æœ‰Hâºç²’å­
            while (stroma.firstChild) {
                stroma.removeChild(stroma.firstChild);
            }
            while (lumen.firstChild) {
                lumen.removeChild(lumen.firstChild);
            }
            
            statusMessage.textContent = "å®éªŒå·²é‡ç½®ï¼Œè¯·ç‚¹å‡»'å‡†å¤‡ç±»å›Šä½“'é‡æ–°å¼€å§‹å®éªŒ";
        }

        // åœæ­¢å®éªŒ
        function stopExperiment() {
            if (state.atpInterval) {
                clearInterval(state.atpInterval);
                state.atpInterval = null;
            }
            state.isRunning = false;
            stopBtn.disabled = true;
            statusMessage.textContent = "å®éªŒå·²åœæ­¢";
        }

        // å…‰ç…§æ§åˆ¶
        lightSwitch.addEventListener('click', function() {
            state.lightOn = !state.lightOn;
            if (state.lightOn) {
                lightSwitch.textContent = "å…‰ç…§: å¼€å¯";
                lightSwitch.classList.remove('light-off');
                lightEffect.style.opacity = '0.3';
                statusMessage.textContent = "å…‰ç…§å·²å¼€å¯ï¼Œè§‚å¯Ÿå…‰åˆç£·é…¸åŒ–è¿‡ç¨‹";
            } else {
                lightSwitch.textContent = "å…‰ç…§: å…³é—­";
                lightSwitch.classList.add('light-off');
                lightEffect.style.opacity = '0';
                statusMessage.textContent = "å…‰ç…§å·²å…³é—­ï¼Œè§‚å¯ŸåŒ–å­¦æ¸—é€è¿‡ç¨‹";
            }
        });

        // é‡ç½®æŒ‰é’®äº‹ä»¶
        resetBtn.addEventListener('click', resetExperiment);

        // åœæ­¢æŒ‰é’®äº‹ä»¶
        stopBtn.addEventListener('click', stopExperiment);

        // æ­¥éª¤1: å‡†å¤‡ç±»å›Šä½“
        step1Btn.addEventListener('click', function() {
            statusMessage.textContent = "æ­£åœ¨ä»è èœå¶ä¸­åˆ†ç¦»ç±»å›Šä½“...";
            
            setTimeout(() => {
                state.thylakoidsPrepared = true;
                step1Btn.disabled = true;
                step2Btn.disabled = false;
                
                // åˆ›å»ºç±»å›Šä½“
                for (let i = 0; i < 5; i++) {
                    const thylakoid = document.createElement('div');
                    thylakoid.className = 'thylakoid';
                    thylakoid.style.left = `${30 + i * 30}px`;
                    thylakoid.style.bottom = '10px';
                    acidBeaker.appendChild(thylakoid);
                    state.thylakoids.push(thylakoid);
                }
                
                statusMessage.textContent = "ç±»å›Šä½“å‡†å¤‡å®Œæˆï¼ç°åœ¨å¯ä»¥å°†å®ƒä»¬ç½®äºé…¸æ€§æº¶æ¶²ä¸­ã€‚";
            }, 1000);
        });

        // æ­¥éª¤2: é…¸æ€§å¤„ç†
        step2Btn.addEventListener('click', function() {
            statusMessage.textContent = "å°†ç±»å›Šä½“ç½®äºpH4é…¸æ€§æº¶æ¶²ä¸­...";
            acidLiquid.style.height = '80%';
            
            setTimeout(() => {
                state.inAcidSolution = true;
                step2Btn.disabled = true;
                step3Btn.disabled = false;
                
                // æ¨¡æ‹ŸH+è¿›å…¥ç±»å›Šä½“
                state.thylakoids.forEach(thylakoid => {
                    thylakoid.style.backgroundColor = '#8BC34A'; // é¢œè‰²å˜æ·±è¡¨ç¤ºH+ç§¯ç´¯
                });
                
                statusMessage.textContent = "é…¸æ€§å¤„ç†å®Œæˆï¼ç±»å›Šä½“å†…å·²ç§¯ç´¯Hâºã€‚ç°åœ¨å¯ä»¥è½¬ç§»åˆ°ç¼“å†²æ¶²ä¸­ã€‚";
            }, 1500);
        });

        // æ­¥éª¤3: è½¬ç§»è‡³ç¼“å†²æ¶²
        step3Btn.addEventListener('click', function() {
            statusMessage.textContent = "å°†ç±»å›Šä½“è½¬ç§»åˆ°å«ADPå’ŒPiçš„pH8ç¼“å†²æ¶²ä¸­...";
            bufferLiquid.style.height = '80%';
            
            setTimeout(() => {
                state.transferred = true;
                step3Btn.disabled = true;
                step4Btn.disabled = false;
                stopBtn.disabled = false;
                
                // ç§»åŠ¨ç±»å›Šä½“åˆ°ç¼“å†²æ¶²çƒ§æ¯
                state.thylakoids.forEach((thylakoid, index) => {
                    thylakoid.style.left = `${280 + index * 30}px`;
                    thylakoid.style.bottom = '10px';
                });
                
                statusMessage.textContent = "è½¬ç§»å®Œæˆï¼ç°åœ¨å¯ä»¥è§‚å¯ŸATPçš„åˆæˆã€‚" + 
                    (state.lightOn ? " (å…‰ç…§æ¡ä»¶ä¸‹)" : " (æ— å…‰æ¡ä»¶ä¸‹)");
            }, 1500);
        });

        // æ­¥éª¤4: è§‚å¯ŸATPåˆæˆ
        step4Btn.addEventListener('click', function() {
            statusMessage.textContent = "æ­£åœ¨è§‚å¯ŸATPåˆæˆ..." + 
                (state.lightOn ? " (å…‰ç…§æ¡ä»¶ä¸‹)" : " (æ— å…‰æ¡ä»¶ä¸‹)");
            
            state.isRunning = true;
            let atpCount = 0;
            const baseSpeed = state.lightOn ? 100 : 200; // å…‰ç…§æ—¶ATPåˆæˆæ›´å¿«
            
            state.atpInterval = setInterval(() => {
                if (!state.isRunning) return;
                
                // å…‰ç…§æ¡ä»¶ä¸‹ATPåˆæˆé€Ÿåº¦æ›´å¿«
                const increment = state.lightOn ? 
                    Math.floor(Math.random() * 5) + 2 : 
                    Math.floor(Math.random() * 3) + 1;
                
                atpCount += increment;
                if (atpCount > 30) atpCount = 30;
                atpCounter.textContent = `ATPæ•°é‡: ${atpCount}`;
                
                // åˆ›å»ºATPç²’å­æ•ˆæœ
                for (let i = 0; i < increment; i++) {
                    createATPParticle();
                }
                
                if (atpCount >= 30) {
                    clearInterval(state.atpInterval);
                    state.atpInterval = null;
                    step4Btn.disabled = true;
                    stopBtn.disabled = true;
                    state.isRunning = false;
                    const conclusion = state.lightOn ? 
                        "å®éªŒå®Œæˆï¼åœ¨å…‰ç…§æ¡ä»¶ä¸‹è§‚å¯Ÿåˆ°æ›´å¤šçš„ATPåˆæˆï¼Œè¯æ˜å…‰ç…§èƒ½ä¿ƒè¿›å…‰åˆç£·é…¸åŒ–è¿‡ç¨‹ã€‚" : 
                        "å®éªŒå®Œæˆï¼åœ¨æ— å…‰æ¡ä»¶ä¸‹æˆåŠŸåˆæˆäº†ATPï¼Œè¯æ˜Hâºæ¢¯åº¦å¯ä»¥é©±åŠ¨ATPåˆæˆã€‚";
                    statusMessage.textContent = conclusion;
                }
            }, baseSpeed);
        });

        // æ·»åŠ Hâºç²’å­
        function addProton(location) {
            const container = location === 'stroma' ? stroma : lumen;
            const proton = document.createElement('div');
            proton.className = 'proton';
            
            // éšæœºä½ç½®
            const x = Math.random() * 380 + 10;
            const y = Math.random() * 80 + 10;
            proton.style.left = `${x}px`;
            proton.style.top = location === 'stroma' ? `${y}px` : `${y + 100}px`;
            
            container.appendChild(proton);
            
            // 5ç§’åæ¶ˆå¤±
            setTimeout(() => {
                proton.remove();
                if (location === 'stroma') {
                    state.stromaProtons--;
                    stromaCount.textContent = state.stromaProtons;
                } else {
                    state.lumenProtons--;
                    lumenCount.textContent = state.lumenProtons;
                }
                checkProtonGradient();
            }, 5000);
        }

        // æ£€æŸ¥è´¨å­æ¢¯åº¦å¹¶åˆæˆATP
        function checkProtonGradient() {
            if (state.lumenProtons > state.stromaProtons && state.lumenProtons > 3) {
                const gradient = state.lumenProtons - state.stromaProtons;
                const atpToAdd = Math.floor(gradient / 3);
                
                if (atpToAdd > 0) {
                    // æ›´æ–°ATPè®¡æ•°å™¨
                    const currentATP = parseInt(atpCounter.textContent.split(':')[1].trim());
                    atpCounter.textContent = `ATPæ•°é‡: ${currentATP + atpToAdd}`;
                    
                    // åˆ›å»ºATPç²’å­æ•ˆæœ
                    for (let i = 0; i < atpToAdd; i++) {
                        createATPParticle();
                    }
                    
                    statusMessage.textContent = `æ£€æµ‹åˆ°è´¨å­æ¢¯åº¦ï¼åˆæˆäº†${atpToAdd}ä¸ªATPåˆ†å­`;
                }
            }
        }

        // æ·»åŠ HâºæŒ‰é’®äº‹ä»¶
        addStromaBtn.addEventListener('click', function() {
            state.stromaProtons++;
            stromaCount.textContent = state.stromaProtons;
            addProton('stroma');
            checkProtonGradient();
        });

        addLumenBtn.addEventListener('click', function() {
            state.lumenProtons++;
            lumenCount.textContent = state.lumenProtons;
            addProton('lumen');
            checkProtonGradient();
        });
    </script>
</body>
</html>
